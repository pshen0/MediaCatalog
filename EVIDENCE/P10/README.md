# P10 Evidence Directory

Этот каталог содержит артефакты безопасности, сгенерированные в рамках практики P10 (SAST & Secrets Scanning).

## Структура файлов

- **`semgrep.sarif`** — Результаты статического анализа кода (Semgrep) в формате SARIF 2.1.0
  - Содержит findings по безопасности, найденные Semgrep
  - Использует профиль `p/ci` и кастомные правила из `security/semgrep/rules.yml`
  - Формат SARIF позволяет интеграцию с GitHub Code Scanning и другими инструментами

- **`gitleaks.json`** — Результаты сканирования секретов (Gitleaks) в формате JSON
  - Содержит информацию о потенциальных секретах, найденных в коде и истории git
  - Использует конфигурацию из `security/.gitleaks.toml`
  - Включает информацию о файлах, строках и типах обнаруженных секретов

- **`sast_summary.md`** — Агрегированная сводка по результатам сканирования
  - Статистика по Semgrep findings (по severity)
  - Статистика по Gitleaks findings
  - Топ-5 наиболее критичных findings
  - План действий и рекомендации

## Использование артефактов

### Для анализа findings

1. Откройте `sast_summary.md` для быстрого обзора
2. Изучите `semgrep.sarif` для детальной информации о SAST findings
3. Проверьте `gitleaks.json` на наличие реальных секретов

### Для триажа findings

1. **Semgrep findings:**
   - Критичные (Error) — исправить немедленно
   - Предупреждения (Warning) — исправить в ближайшем релизе
   - Информационные (Info) — рассмотреть при рефакторинге
   - Ложные срабатывания — обновить правила в `security/semgrep/rules.yml`

2. **Gitleaks findings:**
   - Реальные секреты — немедленно ротировать и удалить из истории git
   - Ложные срабатывания — добавить в allowlist в `security/.gitleaks.toml`

### Для отслеживания в DS-разделе итогового отчёта

Артефакты из этого каталога используются для:

- Демонстрации процесса статического анализа кода
- Отслеживания истории security findings и их исправлений
- Подтверждения соответствия политике безопасности (NFR-05, NFR-06)
- Анализа трендов уязвимостей в коде

## Связь с коммитами и релизами

Каждый набор артефактов привязан к конкретному коммиту через:

- Commit SHA в `sast_summary.md`
- Workflow Run ID в `sast_summary.md`
- Ссылка на GitHub Actions job в `sast_summary.md`

Артефакты также доступны через GitHub Actions artifacts (название: `P10_EVIDENCE`).

## Автоматизация

Артефакты генерируются автоматически при:

- Push в репозиторий (при изменении Python файлов или security конфигураций)
- Ручном запуске workflow (`workflow_dispatch`)
- Изменении самого workflow или конфигураций Semgrep/Gitleaks

## Инструменты

- **Semgrep v1.45.0** — статический анализ кода (фиксированная версия для воспроизводимости)
- **Gitleaks v8.18.0** — сканирование секретов (фиксированная версия для воспроизводимости)

## Кастомные правила

### Semgrep

Кастомные правила для проекта находятся в `security/semgrep/rules.yml`:

- Проверка авторизации в FastAPI эндпоинтах
- Проверка владельца ресурса перед модификацией
- Обнаружение захардкоженных секретов
- Проверка на SQL-инъекции
- Проверка конфигурации CORS
- И другие правила безопасности

### Gitleaks

Конфигурация с allowlist находится в `security/.gitleaks.toml`:

- Игнорирование директорий с артефактами и документацией
- Игнорирование примеров в тестах и документации
- Игнорирование UUID и других не-секретных паттернов

## Критичные типы секретов

Следующие типы секретов считаются критичными и требуют немедленных действий:

1. **API ключи** (AWS, Google Cloud, и т.д.)
2. **Токены доступа** (GitHub, GitLab, и т.д.)
3. **Пароли и credentials**
4. **Приватные ключи** (SSH, GPG, и т.д.)
5. **Database connection strings** с паролями

При обнаружении реального секрета:

1. Немедленно ротировать секрет
2. Удалить из git history (если возможно)
3. Проверить логи и мониторинг на компрометацию
4. Создать Issue для отслеживания инцидента

## См. также

- `.github/workflows/ci-sast-secrets.yml` — workflow для генерации артефактов
- `security/semgrep/rules.yml` — кастомные правила Semgrep
- `security/.gitleaks.toml` — конфигурация Gitleaks
- `docs/adr/ADR-003-dependency-security.md` — архитектурное решение по безопасности
- `docs/security-nfr/NFR.md` — требования безопасности (NFR-05, NFR-06)
