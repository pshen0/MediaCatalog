# P10 Findings Triage

Этот документ содержит триаж findings, обнаруженных инструментами SAST и Secrets Scanning.

## Методология триажа

1. **Критичные (Error)** — исправить немедленно, блокируют merge
2. **Высокие (Warning)** — исправить в ближайшем релизе
3. **Информационные (Info)** — рассмотреть при рефакторинге
4. **Ложные срабатывания** — обновить правила/allowlist

## Semgrep Findings

### Статистика

- **Total findings**: См. `sast_summary.md` для актуальной статистики
- **По severity**: Error / Warning / Info

### Ключевые findings и план действий

#### 1. Проверка авторизации в эндпоинтах

**Статус**: ✅ Уже реализовано

**Описание**: Все эндпоинты в `app/api/media.py` используют `Depends(get_current_user)` для проверки авторизации.

**Действия**: Нет действий, код соответствует требованиям безопасности.

#### 2. Проверка владельца ресурса

**Статус**: ✅ Уже реализовано

**Описание**: Все операции модификации (PUT, DELETE) проверяют `owner_id` перед выполнением.

**Пример из кода**:
```python
if m["owner_id"] != user["id"]:
    return problem(status=403, title="Forbidden", detail="Cannot modify others' media")
```

**Действия**: Нет действий, код соответствует требованиям безопасности.

#### 3. Потенциальные ложные срабатывания

**Статус**: ⚠️ Требует проверки

**Описание**: Semgrep может обнаружить ложные срабатывания в следующих случаях:
- Использование `random` для не-криптографических целей
- Строковые операции, которые не являются SQL-запросами

**Действия**:
- [ ] Запустить Semgrep и проверить все findings
- [ ] Для ложных срабатываний обновить `security/semgrep/rules.yml`
- [ ] Документировать решения в этом файле

## Gitleaks Findings

### Статистика

- **Total secrets found**: См. `sast_summary.md` для актуальной статистики

### Критичные типы секретов

Следующие типы секретов считаются критичными:

1. **API ключи** (AWS, Google Cloud, Azure)
2. **Токены доступа** (GitHub, GitLab, OAuth)
3. **Пароли и credentials**
4. **Приватные ключи** (SSH, GPG, TLS)
5. **Database connection strings** с паролями

### План работы с секретами

1. **При обнаружении реального секрета:**
   - Немедленно ротировать секрет
   - Удалить из git history (если возможно)
   - Проверить логи и мониторинг
   - Создать Issue для отслеживания

2. **При ложном срабатывании:**
   - Добавить паттерн в allowlist в `security/.gitleaks.toml`
   - Документировать причину в комментарии
   - Обновить этот документ

### Известные ложные срабатывания

Следующие паттерны добавлены в allowlist:

1. **UUID в коде** — не являются секретами
2. **Примеры в документации** — тестовые данные
3. **Артефакты в EVIDENCE/** — отчёты безопасности

## Отслеживание исправлений

### Issues

- [ ] Создать Issues для findings, требующих исправления
- [ ] Привязать Issues к конкретным findings в отчётах
- [ ] Обновлять статус Issues по мере исправления

### Backlog

Findings, которые откладываются на будущее:

- Нет (все критичные findings должны быть исправлены)

**Причина откладывания**: N/A

**План пересмотра**: N/A

## История изменений

| Дата | Действие | Findings | Статус |
|------|----------|----------|--------|
| 2025-01-XX | Первый запуск P10 | - | В процессе |

## См. также

- `sast_summary.md` — актуальная сводка по findings
- `semgrep.sarif` — полный отчёт Semgrep
- `gitleaks.json` — полный отчёт Gitleaks
- `security/semgrep/rules.yml` — кастомные правила Semgrep
- `security/.gitleaks.toml` — конфигурация Gitleaks
